/*
 * angular-sticky-plugin
 * https://github.com/mysidewalk/angular-sticky

 * Version: 0.4.2-pr39 - 2018-01-05
 * License: MIT
 */
"use strict";angular.module("hl.sticky",[]).constant("DefaultStickyStackName","default-stack").constant("DefaultStickyStackZIndex",1039).factory("mediaQuery",function(){return{matches:function(t){return t&&(matchMedia("("+t+")").matches||matchMedia(t).matches)}}}).factory("hlStickyStack",["$document","DefaultStickyStackName","DefaultStickyStackZIndex",function(t,n,e){var o=t[0].documentElement,r={};return function(t){var i=(t=t||{}).name||n;if(r[i])return r[i];var a=t.zIndex||e,c=[],u={};return u.options=t,u.stackName=i,u.add=function(t,n){return angular.isString(t)&&""!==t||(t=u.length()),n.id=t,n.zIndex=a,c.push(n),a-=1,n},u.get=function(t){for(var n=0;n<c.length;n++)if(t===c[n].id)return c[n];return!1},u.index=function(t){for(var n=0;n<c.length;n++)if(t===c[n].id)return n;return-1},u.range=function(t,n){return c.slice(t,n)},u.all=function(){return c},u.keys=function(){for(var t=[],n=0;n<c.length;n++)t.push(c[n].id);return t},u.top=function(){return c[c.length-1]},u.remove=function(t){for(var n=0;n<c.length;n++)if(t===c[n].id)return a+=1,c.splice(n,1)[0];return!1},u.removeTop=function(){return a+=1,c.splice(c.length-1,1)[0]},u.length=function(){return c.length},u.height=function(t){var n={top:0,bottom:0};return angular.forEach(c,function(e){n[e.anchor()]+=e.computedHeight(t)}),n[t]},u.heightAt=function(t,n){for(var e,o,r=n-1,i={top:0,bottom:0},a=0;a<c.length;a++)if((e=c[a]).sticksAtPosition(t,r)){var u=e.anchor();o=e.computedHeight(t,r-i[u]),i[u]+=o}return i[t]},u.heightCurrent=function(t){return u.heightAt(t,window.pageYOffset||o.scrollTop)},r[i]=u,u}}]).factory("hlStickyElement",["$document","$log","hlStickyStack","throttle","mediaQuery",function(t,n,e,o,r){return function(o,i){function a(){return I?$:$=k(H)-A-w()}function c(){return I?C:C=v(H)+N+x()}function u(){return!angular.isDefined(i.enable)||i.enable}function l(t,e){if(!d())return!1;switch(t){case"top":return f(e);case"bottom":return s(e);default:n.error('Unknown anchor "'+t+'"')}return!1}function f(t){return(t=void 0!==t?t:window.pageYOffset||z.scrollTop)-(P.clientTop||0)>=a()}function s(t){return(t=void 0!==t?t:window.pageYOffset||z.scrollTop)+window.innerHeight<=c()}function d(){return!1===M||r.matches(M)}function h(){var t=l(O);angular.isDefined(i.enable)&&!i.enable&&(t=!1),angular.isDefined(i.alwaysSticky)&&i.alwaysSticky&&(t=!0),t&&!I?(m(),Y({event:"stick"})):!t&&I&&(g(),Y({event:"unstick"})),I&&("top"===O?o.css("top",A+S(O)-E()+"px"):"bottom"===O&&o.css("bottom",N+S(O)-b()+"px"),o.css("width",y()+"px"))}function m(){I=!0,o.addClass(B),Q&&((D=D||angular.element("<div>")).css("height",p()+"px"),o.after(D));var t=H.getBoundingClientRect(),n={width:y()+"px",position:"fixed",left:t.left+"px","z-index":R?R.get(T).zIndex-(Z.zIndex||0):null};n["margin-"+O]=0,o.css(n)}function g(){I=!1,o.removeClass(B),o.attr("style",j.style),D&&D.remove()}function y(){return H.offsetWidth}function p(){return H.offsetHeight}function k(t){var n=0;if(t&&t.offsetParent)do{n+=t.offsetTop,t=t.offsetParent}while(t);return n}function v(t){return k(t)+t.clientHeight}function S(t){var n=0;if("top"===t&&Z.top>0&&(n+=Z.top),"bottom"===t&&Z.bottom>0&&(n+=Z.bottom),R){var e=R.index(T);"top"===t&&e>0&&R.range(0,e).forEach(function(e){e.isSticky()&&(n+=e.computedHeight(t))}),"bottom"===t&&e!==R.length()-1&&R.range(e+1,R.length()).forEach(function(e){e.isSticky()&&(n+=e.computedHeight(t))})}return n}function w(){return S("top")}function x(){return S("bottom")}function b(t){if(null===L&&(L=void 0!==i.container&&(angular.isString(i.container)?angular.element(P.querySelector("#"+i.container))[0]:i.container)),L){var n=!(null===t||void 0===t),e=L.getBoundingClientRect(),o=n?k(L)+e.height-t:e.top-window.innerHeight+p();return Math.max(0,o-(A+S(O)))}return 0}function E(t){if(null===L&&(L=void 0!==i.container&&(angular.isString(i.container)?angular.element(P.querySelector("#"+i.container))[0]:i.container)),L){var n=!(null===t||void 0===t),e=L.getBoundingClientRect(),o=n?k(L)+e.height-t:e.bottom;return Math.max(0,A+S(O)+p()-o)}return 0}i=i||{};var $,C,D,I=!1,z=t[0].body,H=o[0],P=t[0].documentElement,T=i.id||null,M=!!angular.isDefined(i.mediaQuery)&&i.mediaQuery,B=angular.isString(i.stickyClass)&&""!==i.stickyClass?i.stickyClass:"is-sticky",Q=!angular.isDefined(i.usePlaceholder)||i.usePlaceholder,A=i.offsetTop?parseInt(i.offsetTop,10):0,N=i.offsetBottom?parseInt(i.offsetBottom,10):0,O="string"==typeof i.anchor?i.anchor.toLowerCase().trim():"top",L=null,R=!1===i.stack?null:i.stack||e(),Y=angular.isFunction(i.event)?i.event:angular.noop,Z={top:0,bottom:0},j={style:o.attr("style")||""},q={};if(R){var F=R.add(T,q);T=F.id}return q.draw=function(t){var n=(t=t||{}).offset;n&&(Z.top=n.top||0,Z.bottom=n.bottom||0,Z.zIndex=n.zIndex),!0===t.force&&g(),h()},q.anchor=function(){return O},q.isSticky=function(){return u()&&I||i.alwaysSticky},q.isEnabled=u,q.computedHeight=function(t,n){return"top"===t?Math.max(0,p()-E(n)+A):"bottom"===t?Math.max(0,p()-b(n)+N):0},q.sticksAtPosition=l,q.destroy=function(){g(),R&&R.remove(T)},q}}]).provider("hlStickyElementCollection",function(){var t=0,n={collections:{},defaults:{checkDelay:250},elementsDefaults:{},$get:["$rootScope","$window","$document","$log","DefaultStickyStackName","hlStickyElement","hlStickyStack","throttle",function(e,o,r,i,a,c,u,l){function f(){(t+=1)>1||(p=l(h,n.defaults.checkDelay,{leading:!1}),k.on("resize",p),k.on("scroll",d),g=e.$on("$viewContentLoaded",p),y=e.$on("$includeContentLoaded",p),p())}function s(){(t-=1)>0||(k.off("resize",p),k.off("scroll",d),g(),y())}function d(){m()}function h(){m({force:!0})}function m(t){angular.forEach(n.collections,function(n){n.draw(t)})}var g,y,p,k=angular.element(o);return function(t){t&&angular.isObject(t)||(i.warn("Must supply an options object"),t={});var e=(t=angular.extend({},n.elementsDefaults,t)).name||a,o=parseInt(t.zIndex,10);if(n.collections[e])return n.collections[e];var r=u({name:e,zIndex:o}),l=[],d={};return d.addElement=function(t,n){(n=n||{}).stack=r;var e=c(t,n);return l.push({stickyElement:e,element:t}),e},d.removeElement=function(t){for(var n,e=l.length;e--;)if(angular.isString(t)&&"#"+l[e].element.id===t||l[e].element===t){n=e;break}var o=l.splice(n,1)[0];return o&&o.stickyElement.destroy(),o},d.draw=function(n){var e={};if(t.parent){var o=u({name:t.parent});e.offset={top:o.heightCurrent("top"),zIndex:o.length()}}angular.extend(e,n||{}),angular.forEach(l,function(t){t.stickyElement.draw(e)})},d.destroy=function(){angular.forEach(angular.copy(l),function(t){d.removeElement(t)}),delete n.collections[e],s()},d.trackedElements=function(){return l},n.collections[e]=d,f(),d}}]};return n}).directive("hlSticky",["$log","$window","$document","hlStickyElementCollection","DefaultStickyStackZIndex",function(t,n,e,o,r){return{restrict:"A",scope:{container:"@",anchor:"@",stickyClass:"@",mediaQuery:"@",collection:"@",collectionParent:"@",event:"&",enable:"=",alwaysSticky:"="},link:function(t,n,e){n.addClass("hl-sticky");var i=o({name:t.collection,parent:t.collectionParent,zIndex:e.zIndex||r}),a={id:e.hlSticky,event:function(n){t.event({event:n})}};angular.forEach(["anchor","container","stickyClass","mediaQuery","enable","alwaysSticky"],function(n){angular.isDefined(t[n])&&(a[n]=t[n])}),angular.forEach(["usePlaceholder","offsetTop","offsetBottom"],function(n){angular.isDefined(e[n])&&(a[n]=t.$parent.$eval(e[n]))}),i.addElement(n,a),t.$watch("enable",function(n,e){n!==e&&(a.enable=t.enable,i.draw({force:!0}))}),t.$watch("alwaysSticky",function(n,e){n!==e&&(a.alwaysSticky=t.alwaysSticky,i.draw({force:!0}))}),t.$on("$destroy",function(){i.removeElement(n),i.trackedElements().length||i.destroy()})}}}]).factory("throttle",["$timeout",function(t){return function(n,e,o){var r=null;return o=o||{},function(){var i=this,a=arguments;r||(!1!==o.leading&&n.apply(i,a),r=t(function(){r=null,!1!==o.trailing&&n.apply(i,a)},e,!1))}}}]);